[
  {
    "objectID": "Report.html",
    "href": "Report.html",
    "title": "Introduction",
    "section": "",
    "text": "The data used in this report is from September 2023, sourced from the U.S. Department of Transportation’s Bureau of Transportation Statistics (BTS). The analysis covers key airline performance metrics, including flight cancellations, flight distances, and the number of flights.\n\n# import necessary libraries\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\n# Load data\nal_perf = pd.read_csv(\"../../project data/Data/al_perf.csv\")\nL_AIRLINE_ID = pd.read_csv(\"../../project data/Data/L_AIRLINE_ID.csv\")\nL_AIRPORT_ID = pd.read_csv(\"../../project data/Data/L_AIRPORT_ID.csv\")\nL_AIRPORT = pd.read_csv(\"../../project data/Data/L_AIRPORT.csv\")\nL_CANCELATION = pd.read_csv(\"../../project data/Data/L_CANCELATION.csv\")\nL_DISTANCE_GROUP_250 = pd.read_csv(\"../../project data/Data/L_DISTANCE_GROUP_250.csv\")\nL_WEEKDAYS = pd.read_csv(\"../../project data/Data/L_WEEKDAYS.csv\")\n\n/var/folders/fd/zfxd46k90qd0bd_xk04w45r40000gn/T/ipykernel_91685/3007574736.py:6: DtypeWarning: Columns (69,76,77,84) have mixed types. Specify dtype option on import or set low_memory=False.\n  al_perf = pd.read_csv(\"../../project data/Data/al_perf.csv\")\n\n\n\n1. Airlines Performance Analysis\n\n# Merge airline names into al_perf using airline ID\nal_perf = al_perf.merge(\n    L_AIRLINE_ID, \n    how='left', \n    left_on='DOT_ID_Reporting_Airline',  # Column in al_perf with airline ID\n    right_on='ID'                        # Column in L_AIRLINE_ID with airline ID\n)\n\n# Group by airline name and aggregate key metrics\nairline_perf = al_perf.groupby(\"Name\").agg(\n    avg_arr_delay=(\"ArrDelay\", \"mean\"),   # Average arrival delay per airline\n    avg_dep_delay=(\"DepDelay\", \"mean\"),   # Average departure delay per airline\n    total_cancel=(\"Cancelled\", \"sum\"),    # Total number of cancelled flights per airline\n    total_flights=(\"Flights\", \"sum\")      # Total number of flights per airline\n).reset_index()\n\n# Calculate cancellation rate\nairline_perf[\"cancel_rate\"] = airline_perf[\"total_cancel\"] / airline_perf[\"total_flights\"]\n\n\n\nairline_perf[\"cancel_rate\"] = airline_perf[\"total_cancel\"] / airline_perf[\"total_flights\"]\n\n\n\n\n\n\n\n\nName\navg_arr_delay\navg_dep_delay\ntotal_cancel\ntotal_flights\ncancel_rate\n\n\n\n\n0\nAlaska Airlines Inc.: AS\n1.601164\n4.795336\n87.0\n21426.0\n0.004060\n\n\n1\nAllegiant Air: G4\n9.306200\n11.010626\n22.0\n6892.0\n0.003192\n\n\n2\nAmerican Airlines Inc.: AA\n8.611584\n14.786057\n640.0\n76972.0\n0.008315\n\n\n3\nDelta Air Lines Inc.: DL\n1.125506\n8.480439\n418.0\n81701.0\n0.005116\n\n\n4\nEndeavor Air Inc.: 9E\n2.227870\n9.191383\n777.0\n17319.0\n0.044864\n\n\n5\nEnvoy Air: MQ\n2.458077\n6.411086\n69.0\n18789.0\n0.003672\n\n\n6\nFrontier Airlines Inc.: F9\n14.096099\n17.645867\n329.0\n16353.0\n0.020119\n\n\n7\nHawaiian Airlines Inc.: HA\n2.130003\n3.229774\n69.0\n6718.0\n0.010271\n\n\n8\nJetBlue Airways: B6\n29.581846\n33.672844\n724.0\n21412.0\n0.033813\n\n\n9\nPSA Airlines Inc.: OH\n3.121519\n7.892117\n232.0\n16175.0\n0.014343\n\n\n10\nRepublic Airline: YX\n0.360066\n6.359112\n1707.0\n24839.0\n0.068723\n\n\n11\nSkyWest Airlines Inc.: OO\n4.030539\n8.165868\n230.0\n59245.0\n0.003882\n\n\n12\nSouthwest Airlines Co.: WN\n4.870260\n10.199536\n660.0\n117870.0\n0.005599\n\n\n13\nSpirit Air Lines: NK\n8.571332\n14.800376\n334.0\n21036.0\n0.015878\n\n\n14\nUnited Air Lines Inc.: UA\n3.383344\n9.577271\n760.0\n62591.0\n0.012142\n\n\n\n\n\n\n\n\n# 1. Average Arrival Delay\ndata = airline_perf.sort_values('avg_arr_delay', ascending=False)\nplt.figure(figsize=(12, 8))\nax = sns.barplot(x='avg_arr_delay', y='Name', data=data, palette=\"viridis\")\nfor i, v in enumerate(data['avg_arr_delay']):\n    ax.text(v + 0.1, i, f\"{v:.3f}\", color='black', va='center')  \n\nplt.title(\"Average Arrival Delay by Airline\")\nplt.xlabel(\"Average Arrival Delay (minutes)\")\nplt.ylabel(\"Airline\")\nplt.show()\n\n/var/folders/fd/zfxd46k90qd0bd_xk04w45r40000gn/T/ipykernel_91685/4214137305.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  ax = sns.barplot(x='avg_arr_delay', y='Name', data=data, palette=\"viridis\")\n\n\n\n\n\n\n\n\n\n\n# 2. Average Departure Delay\ndata = airline_perf.sort_values('avg_dep_delay', ascending=False)\nplt.figure(figsize=(12, 8))\nax = sns.barplot(x='avg_dep_delay', y='Name', data=data, palette=\"magma\")\nfor i, v in enumerate(data['avg_dep_delay']):\n    ax.text(v + 0.1, i, f\"{v:.3f}\", color='black', va='center')  \n    \nplt.title(\"Average Departure Delay by Airline\")\nplt.xlabel(\"Average Departure Delay (minutes)\")\nplt.ylabel(\"Airline\")\nplt.show()\n\n/var/folders/fd/zfxd46k90qd0bd_xk04w45r40000gn/T/ipykernel_91685/3867151348.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  ax = sns.barplot(x='avg_dep_delay', y='Name', data=data, palette=\"magma\")\n\n\n\n\n\n\n\n\n\n\n# 3. Total Cancelled Flights\ndata = airline_perf.sort_values('total_cancel', ascending=False)\nplt.figure(figsize=(12, 8))\nax = sns.barplot(x='total_cancel', y='Name', data=data, palette=\"coolwarm\")\nfor i, v in enumerate(data['total_cancel']):\n    \n    ax.text(v + 0.1, i, f\"{v:.0f}\", color='black', va='center')  \nplt.title(\"Total Cancelled Flights by Airline\")\nplt.xlabel(\"Total Cancelled Flights\")\nplt.ylabel(\"Airline\")\nplt.show()\n\n\n/var/folders/fd/zfxd46k90qd0bd_xk04w45r40000gn/T/ipykernel_91685/3656850973.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  ax = sns.barplot(x='total_cancel', y='Name', data=data, palette=\"coolwarm\")\n\n\n\n\n\n\n\n\n\n\n# 4. Cancellation Rate - Scatter plot\ndata = airline_perf.sort_values('cancel_rate', ascending=False)\nplt.figure(figsize=(12, 6))\nplt.scatter(data['Name'], data['cancel_rate'], s=100, color='purple')\nfor i, v in enumerate(data['cancel_rate']):\n    plt.text(i, v + 0.0005, f\"{v:.4f}\", ha='center')\nplt.xticks(rotation=45, ha='right')\nplt.title(\"Cancellation Rate by Airline\")\nplt.xlabel(\"Airline\")\nplt.ylabel(\"Cancellation Rate\")\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\n\n2. Analysis of Cancellation of Flights\n\ncancel_df = pd.read_csv(\"../csv/cancel.csv\")  # Cancellations by reason\nplt.figure(figsize=(6,6))\nplt.pie(cancel_df['Number_Of_Cancellations'],\n        labels=cancel_df['Cancellation_Reason'],\n        autopct='%1.1f%%',\n        startangle=140,\n        colors=sns.color_palette(\"pastel\"))\nplt.title(\"Proportion of Cancellations by Reason\")\nplt.show()\n\n\n\n\n\n\n\n\n\n# 1. Merge airline names\ndf = al_perf.merge(L_AIRLINE_ID, how='left', left_on='DOT_ID_Reporting_Airline', right_on='ID')\n\n# 2. Merge cancellation reason names\ndf = df.merge(L_CANCELATION, how='left', left_on='CancellationCode', right_on='Code')\n\n# 3. Filter only cancelled flights\ncancelled_df = df[df['Cancelled'] == 1]\n\n# 4. Group by airline and cancellation reason\ncancel_summary = cancelled_df.groupby(['Name_y', 'Reason']).size().unstack(fill_value=0)\n\n# 5. Calculate total cancellations per airline\ncancel_summary['Total_Cancellations'] = cancel_summary.sum(axis=1)\n\n\n# 7. Plot stacked bar chart (exclude total column for plotting)\ncancel_summary.drop(columns='Total_Cancellations').plot(kind='bar', stacked=True, figsize=(14, 8), colormap='tab20')\n\nplt.title(\"Number of Cancellations and Composition of Cancellation Reasons by Airline\")\nplt.xlabel(\"Airline\")\nplt.ylabel(\"Number of Cancellations\")\nplt.xticks(rotation=45, ha='right')\nplt.legend(title='Cancellation Reason', bbox_to_anchor=(1.05, 1), loc='upper left')\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\n\n\n3. Analysis of Flight Distance\n\ndf1 = al_perf.merge(\n    L_DISTANCE_GROUP_250,\n    how='left',              \n    left_on='DistanceGroup', \n    right_on='Code'          \n)\n\n\ndistance_counts = df1['DistanceInterval'].value_counts().sort_index()\n\n\nplt.figure(figsize=(12,6))\ndistance_counts.plot(kind='bar', color='skyblue')\nplt.title(\"Number of Flights by Distance Group\")\nplt.xlabel(\"Distance Group\")\nplt.ylabel(\"Number of Flights\")\nplt.xticks(rotation=45, ha='right')\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\ndf2 = df1.merge(L_CANCELATION, how='left', left_on='CancellationCode', right_on='Code')\ncellled_df = df2[df2['Cancelled'] == 1]\n\ncancel_summary_distance =cellled_df.groupby(['DistanceInterval', 'Reason']).size().unstack(fill_value=0)\nplt.figure(figsize=(12,8))\n\ncancel_summary_distance.plot(\n    kind='barh',      \n    stacked=True,    \n    colormap='tab20',\n    ax=plt.gca()\n)\n\nplt.title(\"Number of Cancellations by Distance Group and Reason\")\nplt.xlabel(\"Number of Cancellations\")\nplt.ylabel(\"Distance Group\")\nplt.legend(title='Cancellation Reason', bbox_to_anchor=(1.05, 1), loc='upper left')\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\n\n\n\n4. Analysis of Flight Numbers\n\n\ndf3 = al_perf.merge(L_WEEKDAYS, how='left', left_on='DayOfWeek', right_on='Code')\n\n\nflights_per_day = df3.groupby('Day')['FlightDate'].count()\n\n\nweek_order = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']\nflights_per_day_ordered = flights_per_day.reindex(week_order)\n\n\nplt.figure(figsize=(10,6))\nflights_per_day_ordered.plot(kind='line', marker='o', color='skyblue')\nplt.title(\"Number of Flights by Day of the Week\")\nplt.xlabel(\"Day of the Week\")\nplt.ylabel(\"Number of Flights\")\nplt.xticks(rotation=45)\nplt.grid(axis='y', linestyle='--', alpha=0.7)\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Load Q7.csv (3-day average)\ndf_avg = pd.read_csv(\"../csv/Q7.csv\")\ndf_avg[\"date_flight\"] = pd.to_datetime(df_avg[\"date_flight\"])\n\n# 从 al_perf 计算每天实际航班数\nal_perf[\"FlightDate\"] = pd.to_datetime(al_perf[\"FlightDate\"])\ndaily_flights = al_perf.groupby(\"FlightDate\").size().reset_index(name=\"Flights\")\n\n# 合并每日实际航班数和三天平均\ndf_plot = pd.merge(df_avg, daily_flights, left_on=\"date_flight\", right_on=\"FlightDate\", how=\"left\")\n\n# 绘图\nplt.figure(figsize=(12,6))\n\n# 平均过去3天\nplt.plot(df_plot[\"date_flight\"], df_plot[\"Avg_Flights_Preceding_3_Days\"], marker='o', color='skyblue', label='Avg Flights Preceding 3 Days')\n\n# 当天航班数\nplt.plot(df_plot[\"date_flight\"], df_plot[\"Flights\"], marker='s', color='orange', label='Actual Flights')\n\n# 在每个点上加数值\nfor x, y in zip(df_plot[\"date_flight\"], df_plot[\"Avg_Flights_Preceding_3_Days\"]):\n    plt.text(x, y + 5, f\"{y:.0f}\", ha='center', va='bottom', fontsize=8)\n\nfor x, y in zip(df_plot[\"date_flight\"], df_plot[\"Flights\"]):\n    plt.text(x, y + 5, f\"{y}\", ha='center', va='bottom', fontsize=8)\n\nplt.title(\"Average Flights Over Previous 3 Days vs Actual Flights\", fontsize=16)\nplt.xlabel(\"Date\", fontsize=12)\nplt.ylabel(\"Number of Flights\", fontsize=12)\nplt.xticks(rotation=45)\nplt.grid(axis='y', linestyle='--', alpha=0.7)\nplt.legend()\nplt.tight_layout()\nplt.show()"
  },
  {
    "objectID": "Q4.html",
    "href": "Q4.html",
    "title": "Question",
    "section": "",
    "text": "Find the airport that has the highest average departure delay among all airports. Consider 0 minutes delay for flights that departed early. Output one line of results: the airport name, code, and average delay.\n\nQuery\nselect L_AIRPORT.Name, avg_delay.Origin as airport_code, avg_delay.avg_departure_delay\nfrom (\n    select Origin, avg(DepDelayMinutes) as avg_departure_delay\n    from al_perf\n    group by Origin\n) as avg_delay\njoin L_AIRPORT on avg_delay.Origin = L_AIRPORT.Code\norder by avg_delay.avg_departure_delay desc\nlimit 1;\n\n\nResult\n1 rows returned\n\n\nVisualization\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\n# Load CSV file\ndf = pd.read_csv(\"../csv/Q4.csv\") \n\n# Extract the airport name after the colon (e.g., \"Coastal Carolina Regional\")\ndf['airport_name_clean'] = df['Name'].apply(lambda x: x.split(':')[-1].strip())\n\n# Find the airport with the highest average departure delay\nmax_delay_row = df.loc[df['avg_departure_delay'].idxmax()]\n\nairport_name = max_delay_row['airport_name_clean']\nairport_code = max_delay_row['airport_code']\navg_delay = max_delay_row['avg_departure_delay']\n\n# Display the big number plot\nplt.figure(figsize=(8,5))\n\n# Show the average delay in large red font\nplt.text(0.5, 0.6, f\"{avg_delay:.1f} min\", fontsize=50, ha='center', va='center', color='red', fontweight='bold')\n\n# Show the airport name and code below the number\nplt.text(0.5, 0.35, f\"{airport_name} ({airport_code})\", fontsize=18, ha='center', va='center')\n\n# Remove axes\nplt.axis('off')\n\n# Add a title\nplt.title(\"Airport with Highest Average Departure Delay\", fontsize=18)\n\nplt.tight_layout()\nplt.show()"
  },
  {
    "objectID": "Q5.html",
    "href": "Q5.html",
    "title": "Question",
    "section": "",
    "text": "For each airline find an airport where it has the highest average departure delay. Output an airline name, a name of the airport that has the highest average delay, and the value of that average delay.\n\nQuery\nwith avgdelay as (\n    select \n        dot_id_reporting_airline,\n        originAirportID,\n        avg(DepDelayMinutes) as avg_departure_delay\n    from al_perf\n    group by dot_id_reporting_airline, originAirportID\n),\n\nmax_delay_airline as (\n    select \n        dot_id_reporting_airline,\n        max(avg_departure_delay) as max_delay_dep\n    from avgdelay\n    group by dot_id_reporting_airline\n)\n\nselect\n    L_AIRLINE_ID.Name as airline_name,\n    L_AIRPORT_ID.Name as airport_name,\n    avgdelay.avg_departure_delay\nfrom avgdelay\njoin max_delay_airline\n    on avgdelay.dot_id_reporting_airline = max_delay_airline.dot_id_reporting_airline\n    and avgdelay.avg_departure_delay = max_delay_airline.max_delay_dep\njoin L_AIRLINE_ID\n    on avgdelay.dot_id_reporting_airline = L_AIRLINE_ID.ID\njoin L_AIRPORT_ID\n    on avgdelay.originAirportID = L_AIRPORT_ID.ID\norder by airline_name;\n\n\nResult\n15 rows returned.\n\n\nVisualization\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\n\ndf = pd.read_csv(\"../csv/Q5.csv\")\n\n# Average delay per airline\ncompany_avg_delay = df.groupby('airline_name')['avg_departure_delay'].mean().sort_values()\n\nplt.figure(figsize=(14,8))\nplt.barh(company_avg_delay.index, company_avg_delay.values, color='skyblue')\nplt.title(\"Average Departure Delay by Airline\", fontsize=16)\nplt.xlabel(\"Avg Departure Delay (minutes)\")\nplt.ylabel(\"Airline\")\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\n\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\n\ndf = pd.read_csv(\"../csv/Q5.csv\")\ndf['airport_name_short'] = df['airport_name'].apply(lambda x: x.split(':')[0])\n\n# Average delay per airport\nairport_avg_delay = df.groupby('airport_name_short')['avg_departure_delay'].mean().sort_values()\n\n\nplt.figure(figsize=(14,8))\nplt.barh(airport_avg_delay.index, airport_avg_delay.values, color='skyblue')\n\nplt.title(\"Average Departure Delay by Airport\", fontsize=16)\nplt.xlabel(\"Avg Departure Delay (minutes)\")\nplt.ylabel(\"Airport\")\nplt.tight_layout()\n\n\nplt.show()"
  },
  {
    "objectID": "Q3.html",
    "href": "Q3.html",
    "title": "Question",
    "section": "",
    "text": "Rank days of the week by the number of flights performed by all airlines on that day (1 is the busiest). Output the day of the week names, number of flights and ranks in the rank increasing order.\n\nQuery\nselect \n    rank() over (order by count(al_perf.DayOfWeek) desc) as rank_of_day,\n    L_WEEKDAYS.Day as Day_Name,\n    count(al_perf.DayOfWeek) AS Number_of_flights\nfrom al_perf \njoin L_WEEKDAYS \non al_perf.DayOfWeek = L_WEEKDAYS.Code\ngroup by L_WEEKDAYS.Day\norder by Number_of_flights desc;\n\n\nResult\n7 rows returned\n\n\nVisualization\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Load CSV data\ndf = pd.read_csv(\"../csv/Q3.csv\")\n\n# Reorder Day_Name from Monday to Sunday\nday_order = [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"]\ndf[\"Day_Name\"] = pd.Categorical(df[\"Day_Name\"], categories=day_order, ordered=True)\ndf = df.sort_values(\"Day_Name\")\n\n\n# 1. Line plot with markers\nplt.figure(figsize=(10,5))\nsns.lineplot(\n    x=\"Day_Name\",\n    y=\"Number_of_flights\",\n    data=df,\n    marker=\"o\",\n    markersize=10,\n    linewidth=2,\n    color=\"royalblue\"\n)\n\n# Annotate points\nfor i, row in df.iterrows():\n    plt.text(row[\"Day_Name\"], row[\"Number_of_flights\"] + 1000, \n             f'{row[\"Number_of_flights\"]}', \n             ha='center', va='bottom', fontsize=10)\n\nplt.title(\"Number of Flights by Day of the Week\", fontsize=16)\nplt.xlabel(\"Day of the Week\")\nplt.ylabel(\"Number of Flights\")\nplt.grid(False)\nplt.tight_layout()\nplt.show()\n\n\n# 2. Pie chart showing proportion of flights per day\nplt.figure(figsize=(8,8))\nplt.pie(\n    df[\"Number_of_flights\"], \n    labels=df[\"Day_Name\"], \n    autopct=lambda pct: f\"{pct:.1f}%\\n({int(round(pct/100.*df['Number_of_flights'].sum()))})\",\n    startangle=90, \n    colors=sns.color_palette(\"pastel\")\n)\nplt.title(\"Proportion of Flights by Day of the Week\", fontsize=16)\nplt.tight_layout()\nplt.show()"
  },
  {
    "objectID": "Q1.html",
    "href": "Q1.html",
    "title": "Question",
    "section": "",
    "text": "Find maximal departure delay in minutes for each airline. Sort results from smallest to largest maximum delay. Output airline names and values of the delay.\n\nQuery\nselect l_airline_id.name, max(al_perf.depdelayminutes) as maxdepdelay\nfrom al_perf\njoin l_airline_id on al_perf.dot_id_reporting_airline = l_airline_id.id\ngroup by l_airline_id.name\norder by maxdepdelay asc;\n\n\nResult\n15 rows returned\n\n\nVisualization\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Load CSV and sort by MaxDepDelay\ndf = pd.read_csv(\"../csv/Q1.csv\").sort_values(\"MaxDepDelay\")\n\n# Create horizontal bar plot with color gradient\nplt.figure(figsize=(12,8))\nsns.barplot(x=\"MaxDepDelay\", y=\"Name\", data=df, palette=\"Reds\")\n\n# Add value labels\nfor index, value in enumerate(df[\"MaxDepDelay\"]):\n    plt.text(value + 10, index, str(value), color='black', va='center')\n\n# Set title and labels\nplt.title(\"Maximum Departure Delay by Airline\", fontsize=16)\nplt.xlabel(\"Max Departure Delay (minutes)\")\nplt.ylabel(\"Airline\")\n\nplt.grid(False)\nplt.tight_layout()\nplt.show()\n\n\n/var/folders/fd/zfxd46k90qd0bd_xk04w45r40000gn/T/ipykernel_28836/3593373813.py:10: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(x=\"MaxDepDelay\", y=\"Name\", data=df, palette=\"Reds\")\n\n\n\n\n\n\n\n\n\n\ndf_heat = df.set_index(\"Name\")\nplt.figure(figsize=(6,8))\nsns.heatmap(df_heat[[\"MaxDepDelay\"]], annot=True, fmt=\"d\", cmap=\"Reds\", cbar=True)\nplt.title(\"Maximum Departure Delay by Airline\")\nplt.show()"
  },
  {
    "objectID": "Q7.html",
    "href": "Q7.html",
    "title": "Question",
    "section": "",
    "text": "Build a report that for each day output average number of flights over the preceding 3 days.\n\nQuery\nWith num_flights AS (\n    select DATE(FlightDate) AS date_flight, COUNT(*) as flights\n    from al_perf\n    group by date_flight\n)\nSelect date_flight, \n       AVG(flights) OVER (order by date_flight ROWS BETWEEN 3 PRECEDING AND 1 PRECEDING) as Avg_Flights_Preceding_3_Days\nFrom num_flights\nwhere date_flight is not null;\n\n\nResult\n30 rows returned.\n\n\nVisualization\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\n# Load CSV\ndf = pd.read_csv(\"../csv/Q7.csv\")\n\n# Convert date column to datetime\ndf[\"date_flight\"] = pd.to_datetime(df[\"date_flight\"])\n\n# Create line plot\nplt.figure(figsize=(12,6))\nplt.plot(df[\"date_flight\"], df[\"Avg_Flights_Preceding_3_Days\"])\n\n# Title & labels\nplt.title(\"Average Flights Over Previous 3 Days\", fontsize=16)\nplt.xlabel(\"Date\", fontsize=12)\nplt.ylabel(\"Average Number of Flights\", fontsize=12)\n\n# Rotate date labels\nplt.xticks(rotation=45)\nplt.tight_layout()\nplt.show()"
  },
  {
    "objectID": "Q2.html",
    "href": "Q2.html",
    "title": "Question",
    "section": "",
    "text": "Find maximal early departures in minutes for each airline. Sort results from largest to smallest. Output airline names.\n\nQuery\nselect\n    L_AIRLINE_ID.NAME as Airline_Name,\n    max(-al_perf.DepDelay)as Max_Early_Departure\nfrom al_perf\njoin L_AIRLINE_ID\n    on al_perf.dot_id_reporting_airline = L_AIRLINE_ID.ID\nwhere al_perf.DepDelay &lt; 0\ngroup by L_AIRLINE_ID.NAME\norder by Max_Early_Departure desc;\n\n\nResult\n15 rows returned\n\n\nVisualization\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n\ndf = pd.read_csv(\"../csv/Q2.csv\") \n\n# Sort by Max_Early_Departure descending (highest first)\ndf = df.sort_values(\"Max_Early_Departure\", ascending=False)\n\n# Set figure size\nplt.figure(figsize=(14,6))\n\n# Create vertical bar plot with color gradient\nsns.barplot(\n    x=\"Airline_Name\",\n    y=\"Max_Early_Departure\",\n    data=df,\n    palette=\"Blues\"\n)\n\n# Add value labels on top of bars\nfor index, value in enumerate(df[\"Max_Early_Departure\"]):\n    plt.text(index, value + 0.5, str(value), ha='center', va='bottom', color='black')\n\n# Rotate x-axis labels for readability\nplt.xticks(rotation=45, ha='right')\n\n# Add title and axis labels\nplt.title(\"Maximum Early Departure by Airline\", fontsize=16)\nplt.xlabel(\"Airline\")\nplt.ylabel(\"Max Early Departure (minutes)\")\n\nplt.grid(False)\nplt.tight_layout()\nplt.show()\n\n/var/folders/fd/zfxd46k90qd0bd_xk04w45r40000gn/T/ipykernel_29304/713072887.py:15: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot("
  },
  {
    "objectID": "Q6.html",
    "href": "Q6.html",
    "title": "Question",
    "section": "",
    "text": "Check if your dataset has any canceled flights.\nIf it does, what was the most frequent reason for each departure airport? Output airport name, the most frequent reason, and the number of cancelations for that reason.\n\n\nQuery\nFor 6A\nselect\n    count(*) as num_canceled_flights\nfrom al_perf\nwhere Cancelled = 1;\nFor 6B\nwith AirportCancellationCounts as (\n    select \n        al_perf.OriginAirportID,\n        L_AIRPORT_ID.Name as Airport_Name,\n        al_perf.CancellationCode,\n        count(*) as Number_Of_Cancellations\n    from al_perf\n    join L_AIRPORT_ID on al_perf.OriginAirportID = L_AIRPORT_ID.ID\n    where al_perf.Cancelled = 1\n    group by al_perf.OriginAirportID, L_AIRPORT_ID.Name, al_perf.CancellationCode\n),\nMostFrequentPerAirport as (\n    select \n        OriginAirportID,\n        max(Number_Of_Cancellations) as Max_Cancellations\n    from AirportCancellationCounts\n    group by OriginAirportID\n)\nselect\n    AirportCancellationCounts.Airport_Name,\n    L_CANCELATION.Reason as Most_Frequent_Reason,\n    AirportCancellationCounts.Number_Of_Cancellations\nfrom AirportCancellationCounts\njoin MostFrequentPerAirport \n    on AirportCancellationCounts.OriginAirportID = MostFrequentPerAirport.OriginAirportID\n    and AirportCancellationCounts.Number_Of_Cancellations = MostFrequentPerAirport.Max_Cancellations\njoin L_CANCELATION on AirportCancellationCounts.CancellationCode = L_CANCELATION.Code\norder by AirportCancellationCounts.Number_Of_Cancellations desc;\n\n\nResult\nfor 6A 1 row returned.\nfor 6B 217 rows returned.\n\n\nVisualization\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n\ndf = pd.read_csv(\"../csv/Q6A.csv\")      # Total number of canceled flights\ncancel_df = pd.read_csv(\"../csv/cancel.csv\")  # Cancellations by reason\nq6b_df = pd.read_csv(\"../csv/Q6B.csv\")  # Most frequent cancellation reason per airport\n\n# Big Number Plot: Total canceled flights \nnum_canceled_flights = df.loc[0, 'num_canceled_flights']\n\nplt.figure(figsize=(8,5))\nplt.text(0.5, 0.5, f\"{num_canceled_flights}\", fontsize=60, ha='center', va='center', color='red', fontweight='bold')\nplt.axis('off')\nplt.title(\"Total Number of Canceled Flights\", fontsize=18, fontweight='bold')\nplt.tight_layout()\nplt.show()\n\n# Pie Chart: Proportion of cancellations by reason \nplt.figure(figsize=(6,6))\nplt.pie(cancel_df['Number_Of_Cancellations'],\n        labels=cancel_df['Cancellation_Reason'],\n        autopct='%1.1f%%',\n        startangle=140,\n        colors=sns.color_palette(\"pastel\"))\nplt.title(\"Proportion of Cancellations by Reason\")\nplt.show()\n\n# Select top 20 airports by cancellations\ntop_airports = q6b_df.sort_values('Number_Of_Cancellations', ascending=False).head(20)\n\nplt.figure(figsize=(10,8))\nsns.barplot(\n    data=top_airports,\n    x='Number_Of_Cancellations',\n    y='Airport_Name',\n    hue='Most_Frequent_Reason',\n    dodge=False,\n    palette=\"Set2\"\n)\nplt.title(\"Top 20 Airports by Most Frequent Cancellation Reason\")\nplt.xlabel(\"Number of Cancellations\")\nplt.ylabel(\"Airport\")\nplt.legend(title=\"Cancellation Reason\")\nplt.tight_layout()\nplt.show()"
  }
]